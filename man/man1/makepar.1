.TH makepar 1 "27 April 2023" "MTINV Version 4.0.1" "MTINV Toolkit"

.SH NAME 
makepar \- helper application auto-generates custom C-shell script run.csh for data and Green's function processing and MT inversion. 

.SH SYNOPSIS
makepar 
date="YYYY-MM-ddTHH24:mm:ss.sss"
com="New Region Comment"
DataDir=(string)
RespDir=(string) 
[no]local
[no]verbose
minsnr=(float)
{ ctol=(float) maxshift=(float) }
{ lf=(float) hf=(float) }
[no]gmt5
[no]fullmt
[no]realtime
[no]oracle
[no]mysql
[no]sqlite
maxsta=(integer)
mindist=(float)
maxdist=(float)
evid=(long int)
*.glib

.SH DESCRIPTION
This helper application auto-generates custom C-shell scripts 
.BI run.csh 
.R and 
.BI run2.csh 
.R that contain commands and workflow 
for data and Green's function processing and MT inversion. 
Another helper application at the end of run.csh called mtbestfit 
auto-generates custom C-shell script run2.csh because the one created here is just a template. The 
run.csh file should be further customized manually through iteration using the workflow (see manual).  
.sp
NOTE! Due to possible extensive customization of the file run.csh by the user, 
makepar will not overwrite any existing run.csh and run2.csh scripts. 
The user must delete or rename any pre-existing run.csh manually for safety and rerun makepar.

.SH DT and NT selection in mtinv.par for autogenerated script file run.csh 
.TP
.B code snippet in makepar.c
.PP
.in +2in
.EX
slow_time = dist/vel;
nt = 1024;
dt = 0.45;
if( dist < 2000 )
{
        nt = 1024;
        dt = slow_time/nt;
        dt = roundoff( dt, 100 );
}
if( dist < 100 )
{
        nt = 1024;
        dt = slow_time/nt;
        dt = roundoff( dt, 100 );
}
if( dist <= 50 )
{
        nt = 1024;
        dt = grn_dt + 0.02;
        dt = roundoff( dt, 100 );
}
if(local_setup)
{
        if( dist < 250 ) dt = 0.1;
        if( dist < 180 ) dt = 0.08;
        if( dist < 160 ) dt = 0.07;
        if( dist < 130 ) dt = 0.06;
        if( dist < 100 ) dt = 0.05;
        if( dist <  35 ) dt = 0.05;
}
.EE
.in
.PP

.SH LF and HF selection in mtinv.par for autogenerated script file run.csh
.TP
.B code snippet in makepar.c
.PP
.in +2in
.EX

fnyq = 1.0/(2.0*dt);
*new_lf = lf; /*** set from user ***/
*new_hf = hf;

if( dist < 100 )
{
        *new_lf = 0.020;
        *new_hf = 0.100;
}

if( *new_hf > fnyq ) *new_hf = fnyq;

if(local_setup)
{
        if( dist < 40 )
        {
                *new_lf = 0.020;
                *new_hf = 0.150;
        }
        else
        {
                *new_lf = 0.020;
                *new_hf = 0.100;
        }
}

.EE
.in
.PP

.SH REQUIRED PARAMETERS

.TP
.B date={string}
Origin Time in exact format: YYYY/MM/dd,HH24:mm:ss.sss or YYYY-MM-ddTHH24:mm:ss.sss

.TP
.B *.glib
List of Green's function library files (*.glib) wildcards are accepted.



.SH OPTIONAL PARAMETERS

.TP
.B com={string}
A short comment that goes in the CM tag [default "New Region"]

.TP
.B DataDir=(string)
Directory where the *.SAC files are [default ../Data]

.TP
.B RespDir=(string)
Directory where the SAC_PZs_* files are [default ../Resp]

.TP
.B [no]local
(boolean) setting for when only local distance stations are available (US Array and Transportable Array overrides settings dt and nt, lf and hf)

.TP
.B [no]verbose
Verbosy output for debugging is \fIverbose\fP and for no verbosy output is \fInoverbose\fP [default off].

.TP
.B minsnr=(float)
Minimum SNR allowed Peak-to-Peak amplitude in filtered band [default 3.0]. If minsnr is not achived then the station is automatically turned off "masking chans" for inversion (see mtinv).  Radiation pattern of Love and Rayleigh waves is taken into account. For example, a mask is not applied to low SNR on the transverse channel as long as the Z,R channels are above minsnr.  If the SNR for the transverse component along the transverse component is above minsnr, then the mask is only applied if SNR for Z,R is below minsnr.  The user can override in mtinv by nouse_snr flag or lowering the minsnr to 1 or lower.

.TP
.B ctol=(float)
Minimum Cross-Corrrelation needed to shift the waveforms [default 0.85]. Only the channel (Z,R,T) with the maximum cross-correlation is used as time shift (see mtinv).  Only the lag-time in sec is labeled on the output plot after inversion.  To take the lag-time into effect (in mtinv or misfit/variance reduction metrics) the use must enter this lag-time as a time shift into the mtinv.par file (see glib2inv, sacdata2inv, or mtinv for format).

.TP
.B maxshift=(float)
Maximum lag-time shift allowed when above ctol [default 10.0 sec]. If the lag-time for the channel with cross-correlation higher than ctol is greater than maxshift, then the lag is reported as 0 sec.

.TP
.B lf=(float)
Low frequency corner of the filter  [default 0.01 Hz] applies to all stations

.TP
.B hf=(float)
High frequency corner of the filter  [default 0.1 Hz] applies to all stations

.TP
.B [no]gmt5
Make C-shell scripts compatible with GMT 5+ and GMT 6+ for plotting [default on]. Otherwise the scripts will be in GMT4+ format.  WARNING! as of version mtinv4 gmt4 is no longer support but will remain in the code base.

.TP
.B [no]fullmt
Do full moment tensor instead of deviatoric [default off]. The user can modify the Csh env variable MTDEGFREE=(integer) later in run.csh to do isotropic=1, deviatoric=5, or full-MT=6 inversions (also see mtinv mtdegfree=(integer)).

.TP
.B [no]realtime
controls plotting and interactive level of run.csh scripts required for AutoMT.

.TP
.B [no]oracle
prep mtinv inside run.csh for output create.sql and insert.sql scripts for Oracle database

.TP
.B [no]mysql
prep mtinv inside run.csh for output create.sql and insert.sql scripts for MySQL database

.TP
.B [no]sqlite
prep mtinv inside run.csh for output create.sql and insert.sql scripts for Sqlite3 database

.TP
.B maxsta=(integer)
maximum number of stations to turn on for inversion, all others ista > maxsta are commented out. (Default 8). 
maxsta=8 because there are only 8 panels per output page. Change here or edit mtinv.par section of run.csh script file to uncomment stations for inversion or prediction.

.TP
.B mindist=(float)
Default 80 km. minimum epicenter distance to turn on station for MT inversion, otherwise prediction only rdist<mindist

.TP
.B maxdist=(float)
Default 800 km. maximum epicenter distance to turn on station for MT inversion, otherwise prediction only rdist>maxdist

.TP
.B evid=(long)
EventID upto 10 digits [default -1 none]

.SH EXAMPLE
.br
makepar com="New Madrid, MO" \
    date="2021-11-18T02:53:04.00" \
    DataDir=../Data \
    RespDir=../Resp \
    gmt5 nooracle nomysql sqlite\
    maxsta=8 maxdist=800 \
    lf=0.075 hf=0.15 \
    minsnr=3.0 ctol=0.85 maxshift=10 realtime nolocal *.glib

.SH "SEE ALSO"
.IR glib2inv (1),
.IR sacdata2inv (1),
.IR mtinv (1)
